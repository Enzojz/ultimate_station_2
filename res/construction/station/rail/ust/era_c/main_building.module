local func = require "ust/func"
local coor = require "ust/coor"
local pipe = require "ust/pipe"
local ust = require "ust"
local general = require "ust/general"
local quat = require "ust/quaternion"
local livetext = require "ust/livetext"

local trainstationutil = require "modules/trainstationutil"
local constructionutil = require "constructionutil"

local dump = require "luadump"

local unpack = table.unpack
local insert = table.insert

local ma = math
local pi = ma.pi

--Begin Generated
local generatedData = {
    ["main"] = {
        models = {
            ["station/rail/era_c/station_3_main.mdl"] = {
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000},
            },
        },
    },
    ["clock"] = {
        models = {
            ["station/rail/asset/era_c_big_clock.mdl"] = {
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.01041, -28.19261, 10.29505, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.01041, -5.62261, 7.29505, 1.00000},
            },
        },
    },
    ["assets"] = {
        models = {
            ["asset/roof/era_b_lamp_b_02.mdl"] = {
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 16.24430, -5.20000, 4.39750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 8.76413, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 8.76413, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 1.25469, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 1.25469, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -6.25279, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -6.25279, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.73960, -5.20000, 4.39750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.73960, -5.20000, 4.39750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 6.25943, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 6.25943, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -1.25000, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -1.25000, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -8.75749, -5.20000, 4.39750, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -8.75749, -32.00000, 3.63750, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -16.24430, -5.20000, 4.39750, 1.00000},
            },
            ["station/rail/asset/era_c_single_chair.mdl"] = {
                {-0.00000, -1.00000, 0.00000, 0.00000, 1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 16.24430, -4.60000, 0.80000, 1.00000},
                {-0.00000, -1.00000, 0.00000, 0.00000, 1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -13.72513, -4.60000, 0.80000, 1.00000},
                {-0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -17.50000, -30.54000, 0.00000, 1.00000},
                {-0.00000, -1.00000, 0.00000, 0.00000, 1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 13.73960, -4.60000, 0.80000, 1.00000},
                {-0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 17.50000, -30.54000, 0.00000, 1.00000},
                {-0.00000, -1.00000, 0.00000, 0.00000, 1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -16.22982, -4.60000, 0.80000, 1.00000},
            },
            ["station/rail/asset/era_c_street_pillar.mdl"] = {
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -20.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -18.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -16.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -14.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -12.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -10.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -8.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -6.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -4.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -2.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 2.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 4.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 6.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 8.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 10.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 12.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 14.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 16.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 18.00000, -37.00000, 0.00000, 1.00000},
                {1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 20.00000, -37.00000, 0.00000, 1.00000},
            },
            ["station/rail/asset/era_c_trashcan.mdl"] = {
                {-0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 11.25000, -4.50000, 0.80000, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, 15.41500, -31.15000, 0.00000, 1.00000},
                {-0.00000, 1.00000, 0.00000, 0.00000, -1.00000, -0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -11.25000, -4.50000, 0.80000, 1.00000},
                {-1.00000, -0.00000, 0.00000, 0.00000, 0.00000, -1.00000, 0.00000, 0.00000, 0.00000, 0.00000, 1.00000, 0.00000, -15.41500, -31.15000, 0.00000, 1.00000},
            },
        },
    },
}

local config = {
    extend = {21, -21, 0, -38, 4, 0},
    main = "station/rail/era_c/station_3_main.mdl",
    con_left = {"station/rail/era_c/station_3_main_con_l_1.mdl", "station/rail/era_c/station_3_main_con_l_2.mdl", "station/rail/era_c/station_3_main_con_l_3.mdl", },
    con_right = {"station/rail/era_c/station_3_main_con_r_1.mdl", "station/rail/era_c/station_3_main_con_r_2.mdl", "station/rail/era_c/station_3_main_con_r_3.mdl", },
    end_left = "station/rail/era_c/station_3_main_end_l.mdl",
    end_right = "station/rail/era_c/station_3_main_end_r.mdl",
    roof_side = "station/rail/era_c/station_3_roof_perron_side.mdl",
    roof_head = "station/rail/era_c/station_3_roof_perron_head.mdl",
    slotIdOffset = 1,
    translationY = 0,
}

local mdlList = pipe.new
    + config.con_left
    + config.con_right
    + {config.end_left}
    + {config.end_left}
    + {config.roof_side}
    + {config.roof_head}
    + {config.main}

local updateFn = function(result, transform, tag, slotId, addModelFn, params)
    local hRef = params.platformHeight
    local hVec = coor.xyz(0, 0, hRef - 0.8)
    local hTrans = coor.trans(hVec)
    
    local id = params.modules[slotId].info.id
    local data = params.modules[slotId].info.data
    local info = params.modules[params.classedModules[id].slotId].info
    local metadata = params.modules[params.classedModules[id].slotId].metadata
    local makeData = params.modules[params.classedModules[id].slotId].makeData
    
    -- if n == 0 then n = 1 end
    local n = 2
    
    local centerPts, centerVec = ust.basePts(info.arcs.center, n)
    local refVec = centerVec[1]
    
    local orientation = {
        [1] = coor.xyz(0, -1, 0);
        [3] = coor.xyz(info.pos.y < 0 and -1 or 1, 0, 0);
        [5] = coor.xyz(0, -1, 0);
        [7] = coor.xyz(info.pos.y < 0 and 1 or -1, 0, 0)
    }
    local transf = hTrans
        * quat.byVec(orientation[data], refVec):mRot()
        * ust.getTranfs(info, data, metadata.width)
    
    
    -- if n == 0 then n = 1 end
    local n = 2
    
    
    constructionutil.addModels(generatedData["clock"], result.models, transf, tag)
    constructionutil.addModels(generatedData["assets"], result.models, transf, tag)
    
    for _, mdl in ipairs(mdlList) do
        table.insert(result.models, general.newModel(mdl, tag, transf));
    end

end
function data()
    return {
        availability = {
            yearFrom = 0,
            yearTo = 0,
        },
        buildMode = "SINGLE",
        cost = {
            price = 0,
        },
        description = {
            name = _("MENU_MODULE_MAIN_BUILDING"),
            description = _("MENU_MODULE_MAIN_BUILDING_DESC"),
        },
        category = {
            categories = {"Building"},
        },
        type = "ust_component_polarised_outer",
        order = {
            value = 260,
        },
        metadata = {
            typeName = "ust_component_polarised_outer",
            isComponent = true,
            isBuilding = true,
            typeId = 23,
            width = 5,
            spacing = {20, 20, 38, 0}
        },
        
        updateFn = updateFn,
        
        getModelsFn = function(params)
            return {}
        end
    }

end
